<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å¤§ç‘ç§‘æŠ€è–ªè³‡è¨ˆç®—ç³»çµ±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft JhengHei", "PingFang TC", "Noto Sans TC", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      padding: 20px;
      color: #1a202c;
      min-height: 100vh;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: -1;
    }

    .main-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* é é¢æ¨™é¡Œ */
    .page-header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding: 2rem 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .page-header h1 {
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .page-header p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.1rem;
      font-weight: 400;
    }

    /* å¡ç‰‡æ¨£å¼ */
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-bottom: 2rem;
      transition: all 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e2e8f0;
    }

    .card-header-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 1.5rem;
    }

    .card-header h2 {
      color: #2d3748;
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    /* æ—¥æœŸé¸æ“‡å€ */
    .date-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .input-group label {
      font-weight: 600;
      color: #4a5568;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .input-group label::before {
      content: "ğŸ“…";
      font-size: 1.2rem;
    }

    .input-group input[type="date"] {
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #f7fafc;
    }

    .input-group input[type="date"]:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* æŒ‰éˆ•æ¨£å¼ */
    .btn {
      padding: 0.875rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      width: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    /* æ—¥æ›†è¡¨æ ¼ */
    .calendar-wrapper {
      overflow-x: auto;
      margin: 1.5rem 0;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
      text-align: center;
      padding: 1rem 0.5rem;
      font-size: 1rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    td {
      border: 1px solid #e2e8f0;
      padding: 0.75rem;
      vertical-align: top;
      min-height: 100px;
      background: white;
      transition: all 0.2s ease;
    }

    td:hover {
      background-color: #f7fafc;
      box-shadow: inset 0 0 0 2px #667eea;
    }

    .cell-date {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .cell-label {
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      display: inline-block;
    }

    .holiday {
      color: #e53e3e;
    }

    .holiday .cell-label {
      background: #fed7d7;
      color: #c53030;
    }

    .festival {
      color: #dd6b20;
    }

    .festival .cell-label {
      background: #feebc8;
      color: #c05621;
    }

    .weekday {
      color: #3182ce;
    }

    .weekday .cell-label {
      background: #bee3f8;
      color: #2c5282;
    }

    td input[type="number"] {
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      background: #f7fafc;
    }

    td input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* ç¸½è¨ˆé¡¯ç¤º */
    .total-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .total-display .label {
      font-size: 1rem;
      font-weight: 500;
      opacity: 0.95;
      margin-bottom: 0.5rem;
    }

    .total-display .value {
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    /* è¨ˆç®—å™¨å€åŸŸ */
    .calculator-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group label {
      font-weight: 600;
      color: #4a5568;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-group input[type="number"] {
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      transition: all 0.3s ease;
      background: #f7fafc;
    }

    .form-group input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group input[readonly] {
      background-color: #edf2f7;
      cursor: not-allowed;
      color: #718096;
    }

    /* åŠ ç­æ™‚æ•¸å€å¡Š */
    .overtime-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .overtime-card {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      padding: 1.5rem;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .overtime-card h3 {
      color: #2d3748;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .overtime-card h3::before {
      content: "â°";
      font-size: 1.3rem;
    }

    .overtime-card .form-group {
      margin-bottom: 0.75rem;
    }

    .overtime-card .form-group:last-child {
      margin-bottom: 0;
    }

    .overtime-card label {
      font-size: 0.9rem;
      color: #4a5568;
    }

    /* çµæœé¡¯ç¤º */
    .result-box {
      background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
      border-left: 5px solid #38a169;
      padding: 2rem;
      border-radius: 12px;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(56, 161, 105, 0.15);
    }

    .result-box h3 {
      color: #22543d;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .result-box h3::before {
      content: "ğŸ’°";
      font-size: 1.8rem;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .result-item {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .result-item .label {
      font-size: 0.9rem;
      color: #718096;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .result-item .value {
      font-size: 1.5rem;
      color: #2d3748;
      font-weight: 700;
    }

    .result-detail {
      background: white;
      padding: 1.25rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      font-size: 0.95rem;
      line-height: 1.8;
      color: #4a5568;
    }

    .result-final {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .result-final .label {
      font-size: 1.2rem;
      font-weight: 500;
      opacity: 0.95;
      margin-bottom: 0.5rem;
    }

    .result-final .value {
      font-size: 3rem;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    /* å½ˆçª—æ¨£å¼ */
    #popupModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(8px);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .popup-content {
      background: white;
      padding: 2.5rem;
      max-width: 90%;
      width: 500px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .popup-content h3 {
      margin: 0 0 1.5rem 0;
      color: #667eea;
      font-size: 1.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .popup-content h3::before {
      content: "ğŸ“¢";
      font-size: 2rem;
    }

    #popupText {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #4a5568;
      margin-bottom: 2rem;
    }

    .popup-btn {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .popup-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    /* è¼‰å…¥å‹•ç•« */
    .loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(102, 126, 234, 0.3);
      border-radius: 50%;
      border-top-color: #667eea;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .page-header h1 {
        font-size: 1.8rem;
      }

      .page-header p {
        font-size: 1rem;
      }

      .card {
        padding: 1.5rem;
      }

      .card-header h2 {
        font-size: 1.25rem;
      }

      .date-section {
        grid-template-columns: 1fr;
      }

      .calculator-grid {
        grid-template-columns: 1fr;
      }

      .overtime-grid {
        grid-template-columns: 1fr;
      }

      .result-grid {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.85rem;
      }

      th {
        padding: 0.75rem 0.3rem;
        font-size: 0.85rem;
      }

      td {
        padding: 0.5rem;
      }

      .cell-date {
        font-size: 1rem;
      }

      .total-display .value {
        font-size: 2rem;
      }

      .result-final .value {
        font-size: 2.25rem;
      }

      .popup-content {
        padding: 2rem;
        width: 95%;
      }

      .popup-content h3 {
        font-size: 1.5rem;
      }

      #popupText {
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .page-header {
        padding: 1.5rem 1rem;
        margin-bottom: 1.5rem;
      }

      .page-header h1 {
        font-size: 1.5rem;
      }

      .card {
        padding: 1.25rem;
        margin-bottom: 1.5rem;
      }

      .card-header-icon {
        width: 35px;
        height: 35px;
        font-size: 1.2rem;
      }

      table {
        font-size: 0.75rem;
      }

      th {
        padding: 0.6rem 0.2rem;
        font-size: 0.75rem;
      }

      td {
        padding: 0.4rem;
        min-height: 80px;
      }

      .cell-date {
        font-size: 0.9rem;
      }

      td input[type="number"] {
        font-size: 0.85rem;
        padding: 0.4rem;
      }

      .total-display {
        padding: 1.25rem;
      }

      .total-display .value {
        font-size: 1.75rem;
      }

      .result-final .value {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="page-header">
      <h1>å¤§ç‘ç§‘æŠ€è–ªè³‡è¨ˆç®—ç³»çµ±</h1>
      <p>Salary Calculation System</p>
    </div>

    <!-- æ—¥æœŸé¸æ“‡å¡ç‰‡ -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">ğŸ“†</div>
        <h2>çµç®—æœŸé–“è¨­å®š</h2>
      </div>
      <div class="date-section">
        <div class="input-group">
          <label>é–‹å§‹æ—¥æœŸ</label>
          <input type="date" id="startDate">
        </div>
        <div class="input-group">
          <label>çµæŸæ—¥æœŸ</label>
          <input type="date" id="endDate">
        </div>
      </div>
      <button class="btn btn-primary" onclick="generateCalendar()">
        <span>ğŸ”„</span>
        ç”Ÿæˆçµç®—æ—¥æœŸ
      </button>
    </div>

    <!-- æ—¥æ›†å¡ç‰‡ -->
    <div class="card" id="calendarCard" style="display: none;">
      <div class="card-header">
        <div class="card-header-icon">ğŸ“‹</div>
        <h2>åŠ ç­æ™‚æ•¸ç™»è¨˜</h2>
      </div>
      <div class="calendar-wrapper">
        <table id="calendar">
          <thead>
            <tr>
              <th>é€±æ—¥</th>
              <th>é€±ä¸€</th>
              <th>é€±äºŒ</th>
              <th>é€±ä¸‰</th>
              <th>é€±å››</th>
              <th>é€±äº”</th>
              <th>é€±å…­</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="total-display" id="totalBox">
        <div class="label">åŠ ç­æ™‚æ•¸ç¸½è¨ˆ</div>
        <div class="value"><span id="otTotalHours">0</span> å°æ™‚</div>
      </div>
    </div>

    <!-- è–ªè³‡è¨ˆç®—å¡ç‰‡ -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">ğŸ’µ</div>
        <h2>è–ªè³‡è¨ˆç®—</h2>
      </div>

      <!-- åŸºæœ¬è–ªè³‡ -->
      <div class="calculator-grid">
        <div class="form-group">
          <label>ğŸ’¼ æœ¬è–ªï¼ˆæœˆè–ªï¼‰</label>
          <input type="number" id="baseSalary" placeholder="è«‹è¼¸å…¥æœ¬è–ª">
        </div>
        <div class="form-group">
          <label>ğŸ å…¨å‹¤çé‡‘</label>
          <input type="number" id="bonus" value="2000" readonly>
        </div>
        <div class="form-group">
          <label>ğŸ± ä¼™é£Ÿè²»</label>
          <input type="number" id="meal" value="1800" readonly>
        </div>
        <div class="form-group">
          <label>â• å…¶ä»–æ´¥è²¼</label>
          <input type="number" id="extraPay" placeholder="è«‹è¼¸å…¥å…¶ä»–æ´¥è²¼">
        </div>
        <div class="form-group">
          <label>ğŸ–ï¸ è«‹å‡æ™‚æ•¸</label>
          <input type="number" id="leaveHours" placeholder="è«‹è¼¸å…¥è«‹å‡æ™‚æ•¸">
        </div>
        <div class="form-group">
          <label>ğŸ’° å‹é€€è‡ªæ‰£ (%)</label>
          <input type="number" id="pensionRate" placeholder="è«‹è¼¸å…¥å‹é€€è‡ªæ‰£ç™¾åˆ†æ¯”">
        </div>
        <div class="form-group">
          <label>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å¥ä¿çœ·å±¬äººæ•¸</label>
          <input type="number" id="dependents" placeholder="è«‹è¼¸å…¥çœ·å±¬äººæ•¸">
        </div>
        <div class="form-group">
          <label>ğŸ’Š è£œå……ä¿è²»</label>
          <input type="number" id="supplementaryPremium" placeholder="è‡ªè¡Œå¡«å¯«ç¬¬äºŒé çé‡‘">
        </div>
      </div>

      <!-- åŠ ç­æ™‚æ•¸æ˜ç´° -->
      <div class="overtime-grid">
        <div class="overtime-card">
          <h3>å¹³æ—¥åŠ ç­</h3>
          <div class="form-group">
            <label>å‰2å°æ™‚ (x2.00)</label>
            <input type="number" id="ot2h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
          <div class="form-group">
            <label>ç¬¬3-4å°æ™‚ (x2.33)</label>
            <input type="number" id="ot3to4h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
          <div class="form-group">
            <label>ç¬¬5-6å°æ™‚ (x2.66)</label>
            <input type="number" id="ot5to6h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
        </div>

        <div class="overtime-card">
          <h3>é€±å…­åŠ ç­</h3>
          <div class="form-group">
            <label>å‰2å°æ™‚ (x2.00)</label>
            <input type="number" id="sat2h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
          <div class="form-group">
            <label>ç¬¬3-8å°æ™‚ (x2.33)</label>
            <input type="number" id="sat3to8h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
          <div class="form-group">
            <label>ç¬¬9-12å°æ™‚ (x3.32)</label>
            <input type="number" id="sat9to12h" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
        </div>

        <div class="overtime-card">
          <h3>ç¯€æ—¥åŠ ç­</h3>
          <div class="form-group">
            <label>ç¯€æ—¥åŠ ç­æ™‚æ•¸ (x2.16)</label>
            <input type="number" id="holidayHours" placeholder="è‡ªå‹•è¨ˆç®—" readonly>
          </div>
        </div>
      </div>

      <button class="btn btn-primary" onclick="calculate()">
        <span>ğŸ§®</span>
        é–‹å§‹è¨ˆç®—è–ªè³‡
      </button>

      <!-- çµæœé¡¯ç¤º -->
      <div class="result-box" id="result" style="display: none;"></div>
    </div>
  </div>

  <!-- å½ˆçª— -->
  <div id="popupModal">
    <div class="popup-content">
      <h3>æº«é¦¨æé†’</h3>
      <p id="popupText"></p>
      <button class="popup-btn" onclick="closePopup()">çŸ¥é“äº†</button>
    </div>
  </div>

  <script>
    // å…§åµŒè¨­å®šè³‡æ–™ (è§£æ±º CORS å•é¡Œ)
    const popupConfig = {
      "content": "<b>10/21~11/20</b> æœˆä»½çµç®—,è«‹ä¾æ—¥æœŸå¡«å¯«è‡ªå·±çš„åŠ ç­æ™‚æ•¸,æœƒè‡ªå‹•å°æ‡‰åˆ°ä¸‹æ–¹è¡¨æ ¼ã€‚æˆ–è€…è‡ªå·±æ‰‹å‹•è¼¸å…¥ä¹Ÿå¯ä»¥ã€‚",
      "range": {
        "start": "2025-10-21",
        "end": "2025-11-20"
      },
      "backgroundImage": "https://raw.githubusercontent.com/polo1364/overtime-calculator/refs/heads/main/63EDD52C-F584-4A5A-823A-6F210850519E.png"
    };

    // å‡æ—¥è³‡æ–™
    // åœ‹å®šå‡æ—¥ï¼ˆç¯€æ—¥ï¼‰- ä½¿ç”¨ 2.16 å€ç¯€æ—¥è²»ç‡
    const holidays = {
      "2025-01-01": "å…ƒæ—¦",
      "2025-01-25": "å½ˆæ€§æ”¾å‡ï¼ˆæ˜¥ç¯€ï¼‰",
      "2025-01-27": "å½ˆæ€§æ”¾å‡ï¼ˆæ˜¥ç¯€ï¼‰",
      "2025-01-28": "é™¤å¤•",
      "2025-01-29": "æ˜¥ç¯€",
      "2025-01-30": "æ˜¥ç¯€",
      "2025-01-31": "æ˜¥ç¯€",
      "2025-02-28": "å’Œå¹³ç´€å¿µæ—¥",
      "2025-04-03": "å½ˆæ€§æ”¾å‡ï¼ˆæ¸…æ˜ç¯€ï¼‰",
      "2025-04-04": "å…’ç«¥ç¯€èˆ‡æ¸…æ˜ç¯€",
      "2025-05-01": "å‹å‹•ç¯€",
      "2025-05-30": "å½ˆæ€§æ”¾å‡ï¼ˆç«¯åˆç¯€ï¼‰",
      "2025-05-31": "ç«¯åˆç¯€",
      "2025-09-28": "å­”å­èª•è¾°ç´€å¿µæ—¥",
      "2025-09-29": "å½ˆæ€§æ”¾å‡ï¼ˆå­”å­èª•è¾°ï¼‰",
      "2025-10-05": "å½ˆæ€§æ”¾å‡ï¼ˆä¸­ç§‹ç¯€ï¼‰",
      "2025-10-06": "ä¸­ç§‹ç¯€",
      "2025-10-10": "åœ‹æ…¶æ—¥",
      "2025-10-24": "å½ˆæ€§æ”¾å‡ï¼ˆå…‰å¾©ç¯€ï¼‰",
      "2025-10-25": "å°ç£å…‰å¾©ç¯€",
      "2025-12-25": "è¡Œæ†²ç´€å¿µæ—¥"
    };

    // é«˜é›„å¸‚é¢±é¢¨å‡ï¼ˆå‡æ—¥ï¼‰- ä½¿ç”¨å‡æ—¥è²»ç‡ï¼ˆ2.00/2.33/3.32 å€ï¼‰
    const typhoonHolidays = {
      "2025-07-06": "é¢±é¢¨å‡ï¼ˆä¸¹å¨œçµ²é¢±é¢¨ï¼‰",
      "2025-07-07": "é¢±é¢¨å‡ï¼ˆä¸¹å¨œçµ²é¢±é¢¨ï¼‰",
      "2025-08-13": "é¢±é¢¨å‡ï¼ˆæ¥ŠæŸ³é¢±é¢¨ï¼‰",
      "2025-11-12": "é¢±é¢¨å‡ï¼ˆé³³å‡°é¢±é¢¨ï¼‰"
    };

    const makeupWorkdays = ["2025-02-08"];

    // ä¿éšªè²»ç‡è¡¨
    const insuranceTable = [
      { salary: 28590, labor: 715, health: 444 },
      { salary: 28800, labor: 720, health: 447 },
      { salary: 30300, labor: 758, health: 470 },
      { salary: 31800, labor: 795, health: 493 },
      { salary: 33300, labor: 833, health: 516 },
      { salary: 34800, labor: 870, health: 540 },
      { salary: 36300, labor: 908, health: 563 },
      { salary: 38200, labor: 955, health: 592 },
      { salary: 40100, labor: 1003, health: 622 },
      { salary: 42000, labor: 1050, health: 651 },
      { salary: 43900, labor: 1098, health: 681 },
      { salary: 45800, labor: 1145, health: 710 },
      { salary: 47700, labor: 1193, health: 740 },
      { salary: 49600, labor: 1240, health: 769 },
      { salary: 51500, labor: 1288, health: 799 },
      { salary: 53400, labor: 1335, health: 828 },
      { salary: 55300, labor: 1383, health: 858 },
      { salary: 57200, labor: 1430, health: 887 },
      { salary: 59100, labor: 1478, health: 917 },
      { salary: 61000, labor: 1525, health: 946 },
      { salary: 62900, labor: 1573, health: 976 },
      { salary: 64800, labor: 1620, health: 1005 },
      { salary: 66700, labor: 1668, health: 1035 },
      { salary: 68600, labor: 1715, health: 1064 },
      { salary: 70500, labor: 1763, health: 1094 },
      { salary: 72400, labor: 1810, health: 1123 },
      { salary: 74300, labor: 1858, health: 1153 },
      { salary: 76200, labor: 1905, health: 1182 },
      { salary: 78100, labor: 1953, health: 1212 },
      { salary: 80000, labor: 2000, health: 1241 },
      { salary: 81900, labor: 2048, health: 1271 },
      { salary: 83800, labor: 2095, health: 1300 },
      { salary: 85700, labor: 2143, health: 1330 },
      { salary: 87600, labor: 2190, health: 1359 },
      { salary: 89500, labor: 2238, health: 1389 }
    ];

    // ç”Ÿæˆæ—¥æ›†
    function generateCalendar() {
      const start = new Date(document.getElementById("startDate").value);
      const end = new Date(document.getElementById("endDate").value);
      const tbody = document.querySelector("#calendar tbody");
      tbody.innerHTML = "";

      if (isNaN(start) || isNaN(end) || start > end) {
        alert("è«‹é¸æ“‡æœ‰æ•ˆçš„èµ·è¨–æ—¥æœŸ");
        return;
      }

      let currentRow = document.createElement("tr");
      let d = new Date(start);

      // å¡«å……é–‹å§‹æ—¥æœŸå‰çš„ç©ºç™½
      for (let i = 0; i < d.getDay(); i++) {
        currentRow.appendChild(document.createElement("td"));
      }

      // ç”Ÿæˆæ—¥æœŸæ ¼å­
      for (; d <= end; d.setDate(d.getDate() + 1)) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${yyyy}-${mm}-${dd}`;
        const weekday = d.getDay();

        let label = "å¹³æ—¥";
        let className = "weekday";
        let dayType = "weekday";

        // åˆ¤æ–·é€±æœ«
        if ((weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key)) {
          label = "å‡æ—¥";
          className = "holiday";
          dayType = "weekend";
        }

        // åˆ¤æ–·è£œç­æ—¥ï¼ˆä½¿ç”¨ç¯€æ—¥è²»ç‡ï¼‰
        if (makeupWorkdays.includes(key)) {
          label = "è£œç­æ—¥";
          className = "festival";
          dayType = "holiday";
        }

        // åˆ¤æ–·ç¯€æ—¥
        if (holidays[key]) {
          label = holidays[key];
          className = (weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key) ? "holiday" : "festival";
          dayType = "holiday";
        }

        // åˆ¤æ–·é¢±é¢¨å‡ï¼ˆä½¿ç”¨å‡æ—¥è²»ç‡ï¼‰
        if (typhoonHolidays[key]) {
          label = typhoonHolidays[key];
          className = "holiday";
          dayType = "weekend";
        }

        const cell = document.createElement("td");
        cell.classList.add(className);
        cell.innerHTML = `
          <span class="cell-date">${mm}/${dd}</span>
          <span class="cell-label">${label}</span>
          <input type="number" min="0" step="0.5" placeholder="æ™‚æ•¸" data-daytype="${dayType}" onchange="updateTotal()" />
        `;
        currentRow.appendChild(cell);

        // æ¯é€±å…­æ›è¡Œ
        if (weekday === 6) {
          tbody.appendChild(currentRow);
          currentRow = document.createElement("tr");
        }
      }

      // å¡«å……çµæŸæ—¥æœŸå¾Œçš„ç©ºç™½
      if (currentRow.children.length > 0) {
        while (currentRow.children.length < 7) {
          currentRow.appendChild(document.createElement("td"));
        }
        tbody.appendChild(currentRow);
      }

      document.getElementById("calendarCard").style.display = "block";
      updateTotal();
    }

    // æ›´æ–°åŠ ç­æ™‚æ•¸ç¸½è¨ˆ
    function updateTotal() {
      const inputs = document.querySelectorAll("td input[type='number']");
      let w2 = 0, w233 = 0, w266 = 0;
      let s2 = 0, s233 = 0, s332 = 0;
      let holiday = 0;

      inputs.forEach(i => {
        const v = parseFloat(i.value);
        if (isNaN(v)) return;
        const type = i.dataset.daytype;

        if (type === "weekday") {
          w2 += Math.min(v, 2);
          w233 += Math.min(Math.max(v - 2, 0), 2);
          w266 += Math.max(v - 4, 0);
        } else if (type === "weekend") {
          s2 += Math.min(v, 2);
          s233 += Math.min(Math.max(v - 2, 0), 6);
          s332 += Math.max(v - 8, 0);
        } else if (type === "holiday") {
          holiday += v;
        }
      });

      document.getElementById("ot2h").value = w2 ? w2.toFixed(1) : "";
      document.getElementById("ot3to4h").value = w233 ? w233.toFixed(1) : "";
      document.getElementById("ot5to6h").value = w266 ? w266.toFixed(1) : "";

      document.getElementById("sat2h").value = s2 ? s2.toFixed(1) : "";
      document.getElementById("sat3to8h").value = s233 ? s233.toFixed(1) : "";
      document.getElementById("sat9to12h").value = s332 ? s332.toFixed(1) : "";

      document.getElementById("holidayHours").value = holiday ? holiday.toFixed(1) : "";

      const total = w2 + w233 + w266 + s2 + s233 + s332 + holiday;
      document.getElementById("otTotalHours").textContent = total.toFixed(1);
    }

    // è¼”åŠ©å‡½å¼
    function parse(id) {
      return parseFloat(document.getElementById(id).value) || 0;
    }

    function getInsurance(salary) {
      return insuranceTable.find(row => salary <= row.salary) || insuranceTable[insuranceTable.length - 1];
    }

    // è¨ˆç®—è–ªè³‡
    function calculate() {
      const base = parse("baseSalary");
      
      if (base === 0) {
        alert("è«‹è¼¸å…¥æœ¬è–ª");
        return;
      }

      const bonus = 2000;
      const meal = 1800;
      const extra = parse("extraPay");
      const totalBase = base + bonus + meal + extra;

      const ins = getInsurance(totalBase);
      const labor = ins.labor;
      const personalHealth = ins.health;
      const dependents = parse("dependents");
      const dependentHealth = personalHealth * dependents;
      const health = personalHealth + dependentHealth;

      const hourly = totalBase / 30 / 8;
      const leave = parse("leaveHours");
      const pensionRate = parse("pensionRate") / 100;
      const leaveDeduct = leave * hourly;

      const ot1 = parse("ot2h");
      const ot2 = parse("ot3to4h");
      const ot3 = parse("ot5to6h");
      const s1 = parse("sat2h");
      const s2 = parse("sat3to8h");
      const s3 = parse("sat9to12h");
      const h1 = parse("holidayHours");

      const fee1 = ot1 * 2 * hourly;
      const fee2 = ot2 * 2.33 * hourly;
      const fee3 = ot3 * 2.66 * hourly;
      const feeSat1 = s1 * 2 * hourly;
      const feeSat2 = s2 * 2.33 * hourly;
      const feeSat3 = s3 * 3.32 * hourly;
      const feeHoliday = h1 * 2.16 * hourly;

      const mealWD = Math.ceil(ot1 % 2 === 0 ? ot1 / 2 : (Math.floor(ot1) + 1) / 2) * 60;
      const mealSat = Math.floor((s1 + s2) / 8) * 60;
      const mealH = Math.ceil(h1 / 8) * 60;

      const otTotal = ot1 + ot2 + ot3 + s1 + s2 + s3 + h1;
      const otBonus = otTotal >= 50 ? 3000 : otTotal >= 40 ? 2000 : otTotal >= 30 ? 1500 : 0;

      const pension = Math.round(ins.salary * pensionRate);
      const welfare = Math.round((base + bonus + extra) * 0.005);

      // è£œå……ä¿è²»è¨ˆç®—
      const supplementaryPremiumBase = parse("supplementaryPremium");
      const supplementaryPremiumFee = Math.round(supplementaryPremiumBase * 0.0211);

      const net = totalBase - labor - health - pension - welfare - leaveDeduct - supplementaryPremiumFee + 
                  fee1 + fee2 + fee3 + feeSat1 + feeSat2 + feeSat3 + feeHoliday + 
                  mealWD + mealSat + mealH + otBonus;

      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";
      
      let bonusHtml = "";
      if (otTotal >= 30) {
        bonusHtml = `
          <div class="result-item">
            <div class="label">åŠ ç­æ™‚æ•¸çé‡‘ï¼ˆ${otTotal.toFixed(1)} å°æ™‚ï¼‰</div>
            <div class="value">${otBonus.toLocaleString()} å…ƒ</div>
          </div>
        `;
      }
      
      resultDiv.innerHTML = `
        <h3>è¨ˆç®—çµæœ</h3>
        
        <div class="result-grid">
          <div class="result-item">
            <div class="label">æ™‚è–ª</div>
            <div class="value">${hourly.toFixed(2)} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">å¹³æ—¥åŠ ç­è²»</div>
            <div class="value">${(fee1 + fee2 + fee3).toFixed(0).toLocaleString()} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">å¹³æ—¥èª¤é¤è²»</div>
            <div class="value">${mealWD} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">é€±å…­åŠ ç­è²»</div>
            <div class="value">${(feeSat1 + feeSat2 + feeSat3).toFixed(0).toLocaleString()} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">é€±å…­èª¤é¤è²»</div>
            <div class="value">${mealSat} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">ç¯€æ—¥åŠ ç­è²»</div>
            <div class="value">${feeHoliday.toFixed(0).toLocaleString()} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">ç¯€æ—¥èª¤é¤è²»</div>
            <div class="value">${mealH} å…ƒ</div>
          </div>
          <div class="result-item">
            <div class="label">è£œå……ä¿è²»</div>
            <div class="value">${supplementaryPremiumFee.toLocaleString()} å…ƒ</div>
          </div>
          ${bonusHtml}
        </div>

        <div class="result-detail">
          <strong>æ‰£æ¬¾æ˜ç´°ï¼š</strong>${(labor + health + welfare + pension + leaveDeduct + supplementaryPremiumFee).toFixed(0).toLocaleString()} å…ƒ<br>
          â€¢ å‹ä¿ï¼š${labor.toLocaleString()} å…ƒ<br>
          â€¢ å¥ä¿æœ¬äººï¼š${personalHealth.toLocaleString()} å…ƒ<br>
          â€¢ å¥ä¿çœ·å±¬ï¼š${dependentHealth.toLocaleString()} å…ƒ<br>
          â€¢ ç¦åˆ©é‡‘ï¼š${welfare.toLocaleString()} å…ƒ<br>
          â€¢ å‹é€€ï¼š${pension.toLocaleString()} å…ƒ<br>
          â€¢ è£œå……ä¿è²»ï¼š${supplementaryPremiumFee.toLocaleString()} å…ƒ<br>
          â€¢ è«‹å‡æ‰£æ¬¾ï¼š${leaveDeduct.toFixed(0).toLocaleString()} å…ƒ
        </div>

        <div class="result-final">
          <div class="label">å¯¦é ˜è–ªè³‡</div>
          <div class="value">NT$ ${net.toFixed(0).toLocaleString()}</div>
        </div>
      `;
      
      // æ»¾å‹•åˆ°çµæœå€
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // é—œé–‰å½ˆçª—
    function closePopup() {
      document.getElementById("popupModal").style.display = "none";
    }

    // åˆå§‹åŒ–å½ˆçª—è³‡æ–™ (ä½¿ç”¨å…§åµŒè³‡æ–™)
    window.addEventListener('DOMContentLoaded', function() {
      document.getElementById("popupText").innerHTML = popupConfig.content.replace(/\\n/g, "<br>");

      if (popupConfig.range) {
        document.getElementById("startDate").value = popupConfig.range.start || "";
        document.getElementById("endDate").value = popupConfig.range.end || "";
      }

      if (popupConfig.backgroundImage) {
        document.body.style.backgroundImage = `url('${popupConfig.backgroundImage}')`;
      }
    });
  </script>
</body>
</html>
