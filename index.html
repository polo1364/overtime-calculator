<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>å¤§ç‘ç§‘æŠ€ | è–ªè³‡ç®¡ç†ç³»çµ±</title>
  
  <!-- å¼•å…¥ Google Fonts å­—å‹ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #2563eb;       /* å°ˆæ¥­è— */
      --primary-dark: #1e40af;
      --secondary-color: #64748b;     /* æ¬¡è¦ç° */
      --accent-color: #0ea5e9;        /* äº®è—å¼·èª¿ */
      --success-color: #10b981;       /* æˆåŠŸç¶  */
      --warning-color: #f59e0b;       /* è­¦å‘Šæ©˜ */
      --danger-color: #ef4444;        /* å±éšªç´… */
      --bg-color: #f8fafc;            /* èƒŒæ™¯è‰² */
      --card-bg: #ffffff;
      --text-main: #1e293b;
      --text-sub: #475569;
      --border-radius: 12px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans TC', sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      padding-bottom: 40px;
      background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
      background-size: 20px 20px;
    }

    /* Header */
    .header-banner {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
      color: white;
      padding: 2rem 1rem 3rem;
      text-align: center;
      border-radius: 0 0 30px 30px;
      box-shadow: var(--shadow-lg);
      margin-bottom: -2rem;
    }

    .header-banner h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: 1px;
    }

    .header-banner p {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 300;
    }

    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* å¡ç‰‡é€šç”¨æ¨£å¼ */
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(226, 232, 240, 0.8);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .card-title-icon {
      background: #eff6ff;
      color: var(--primary-color);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .card-title h2 {
      font-size: 1.25rem;
      color: var(--text-main);
      font-weight: 600;
    }

    /* ç¶²æ ¼ä½ˆå±€ */
    .grid-cols-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .grid-cols-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    /* è¡¨å–®å…ƒç´  */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-sub);
      margin-bottom: 0.4rem;
    }

    .input-wrapper {
      position: relative;
    }

    .input-wrapper input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s;
      background: #fff;
    }

    .input-wrapper input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .input-wrapper input[readonly] {
      background-color: #f1f5f9;
      border-color: #e2e8f0;
      color: #64748b;
      cursor: not-allowed;
    }
    
    /* å”¯è®€åœ–ç¤º */
    .readonly-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
      font-size: 0.8rem;
    }

    /* æŒ‰éˆ• */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
      font-size: 1rem;
      width: 100%;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: white;
      border: 1px solid #cbd5e1;
      color: var(--text-sub);
    }

    /* æ—¥æ›†æ¨£å¼å„ªåŒ– */
    .calendar-container {
      overflow-x: auto;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
    }

    table.calendar-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px; /* å¼·åˆ¶æœ€å°å¯¬åº¦ï¼Œé¿å…æ‰‹æ©Ÿæ“ å£“ */
    }

    th {
      background: #f8fafc;
      color: var(--text-sub);
      font-weight: 600;
      padding: 1rem;
      text-align: left;
      border-bottom: 2px solid #e2e8f0;
    }

    td {
      padding: 0.75rem;
      border-bottom: 1px solid #e2e8f0;
      border-right: 1px solid #f1f5f9;
      vertical-align: top;
      background: white;
      position: relative;
    }
    
    td:last-child { border-right: none; }

    /* æ—¥æœŸæ¨™ç±¤ */
    .date-badge {
      display: inline-block;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-main);
    }

    .type-badge {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 500;
      margin-left: 5px;
    }

    /* é€±æœ«èˆ‡å‡æ—¥é…è‰² */
    .cell-weekday input { border-color: #cbd5e1; }
    
    .cell-weekend { background-color: #fafafa; }
    .cell-weekend .date-badge { color: var(--danger-color); }
    .cell-weekend .type-badge { background: #fee2e2; color: #991b1b; }

    .cell-festival { background-color: #fff7ed; }
    .cell-festival .date-badge { color: var(--warning-color); }
    .cell-festival .type-badge { background: #ffedd5; color: #9a3412; }

    td input[type="number"] {
      width: 100%;
      padding: 6px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
    }
    
    td input[type="number"]:focus {
      border-color: var(--primary-color);
      background: #fff;
    }

    /* è–ªè³‡å–®çµæœæ¨£å¼ */
    .payslip {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
    }

    .payslip-header {
      background: #f8fafc;
      padding: 1.5rem;
      text-align: center;
      border-bottom: 1px solid #e2e8f0;
    }

    .payslip-header h3 { color: var(--text-main); font-size: 1.2rem; }
    .payslip-header .amount { font-size: 2.5rem; font-weight: 700; color: var(--primary-color); margin-top: 0.5rem; }

    .payslip-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }

    @media (max-width: 768px) {
      .payslip-body { grid-template-columns: 1fr; }
    }

    .payslip-section {
      padding: 1.5rem;
    }
    
    .payslip-section.income { border-right: 1px solid #f1f5f9; }
    .payslip-section h4 { 
      font-size: 0.9rem; 
      text-transform: uppercase; 
      letter-spacing: 1px; 
      color: var(--text-sub); 
      margin-bottom: 1rem; 
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #f1f5f9;
    }

    .payslip-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.8rem;
      font-size: 0.95rem;
    }

    .payslip-row.total {
      margin-top: 1rem;
      padding-top: 0.8rem;
      border-top: 1px dashed #cbd5e1;
      font-weight: 700;
      color: var(--text-main);
    }

    .payslip-row .val { font-family: 'Consolas', monospace; font-weight: 600; }
    .text-green { color: var(--success-color); }
    .text-red { color: var(--danger-color); }

    /* å½ˆçª—å„ªåŒ– */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      width: 90%;
      max-width: 500px;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    /* å€å¡Šæ¨™é¡Œ */
    .section-header {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--text-sub);
      margin: 1.5rem 0 1rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .section-header::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #e2e8f0;
    }

  </style>
</head>
<body>

  <!-- é ­éƒ¨ -->
  <div class="header-banner">
    <h1>å¤§ç‘ç§‘æŠ€</h1>
    <p>è–ªè³‡è¨ˆç®—ç®¡ç†ç³»çµ± | Salary Management System</p>
  </div>

  <div class="main-container">
    
    <!-- 1. è¨­å®šå€å¡Š -->
    <div class="card" style="margin-top: 4rem;">
      <div class="card-title">
        <div class="card-title-icon">ğŸ“…</div>
        <h2>çµç®—é€±æœŸè¨­å®š</h2>
      </div>
      
      <div class="grid-cols-2">
        <div class="form-group">
          <label class="form-label">é–‹å§‹æ—¥æœŸ</label>
          <div class="input-wrapper">
            <input type="date" id="startDate">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">çµæŸæ—¥æœŸ</label>
          <div class="input-wrapper">
            <input type="date" id="endDate">
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary" onclick="generateCalendar()">
        ç”ŸæˆåŠ ç­å¡«å¯«è¡¨
      </button>
    </div>

    <!-- 2. åŠ ç­å¡«å¯«å€ (é è¨­éš±è—) -->
    <div class="card" id="calendarCard" style="display: none;">
      <div class="card-title">
        <div class="card-title-icon">â°</div>
        <h2>åŠ ç­æ™‚æ•¸ç™»è¨˜</h2>
      </div>
      
      <p style="margin-bottom: 1rem; color: var(--text-sub); font-size: 0.9rem;">
        â€» è«‹ä¾ç…§æ¯æ—¥å¯¦éš›ç‹€æ³å¡«å¯«åŠ ç­æ™‚æ•¸ï¼Œç³»çµ±å°‡è‡ªå‹•åˆ¤æ–·å¹³æ—¥ã€å‡æ—¥èˆ‡ç¯€æ—¥è²»ç‡ã€‚
      </p>

      <div class="calendar-container">
        <table class="calendar-table" id="calendar">
          <thead>
            <tr>
              <th>é€±æ—¥</th><th>é€±ä¸€</th><th>é€±äºŒ</th><th>é€±ä¸‰</th><th>é€±å››</th><th>é€±äº”</th><th>é€±å…­</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="margin-top: 1.5rem; text-align: right;">
        <span style="color: var(--text-sub); font-weight: 500;">ç›®å‰ç™»è¨˜ç¸½æ™‚æ•¸ï¼š</span>
        <span id="otTotalHours" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">0.0</span>
        <span style="font-size: 0.9rem;">å°æ™‚</span>
      </div>
    </div>

    <!-- 3. è–ªè³‡åƒæ•¸å€ -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">âš™ï¸</div>
        <h2>è–ªè³‡åƒæ•¸é…ç½®</h2>
      </div>

      <div class="grid-cols-2">
        <!-- å·¦å´ï¼šæ”¶å…¥ç›¸é—œ -->
        <div>
          <div class="section-header">ğŸ’° æ”¶å…¥åƒæ•¸</div>
          <div class="form-group">
            <label class="form-label">æœ¬è–ª (æœˆè–ª)</label>
            <div class="input-wrapper">
              <input type="number" id="baseSalary" placeholder="è¼¸å…¥æœ¬è–ª">
            </div>
          </div>
          <div class="grid-cols-2" style="gap: 10px;">
            <div class="form-group">
              <label class="form-label">å…¨å‹¤çé‡‘ (å›ºå®š)</label>
              <div class="input-wrapper">
                <input type="number" id="bonus" value="2000" readonly>
                <span class="readonly-icon">ğŸ”’</span>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">ä¼™é£Ÿè²» (å›ºå®š)</label>
              <div class="input-wrapper">
                <input type="number" id="meal" value="1800" readonly>
                <span class="readonly-icon">ğŸ”’</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">å…¶ä»–æ´¥è²¼</label>
            <div class="input-wrapper">
              <input type="number" id="extraPay" placeholder="ä¾‹å¦‚ï¼šè·å‹™åŠ çµ¦">
            </div>
          </div>
        </div>

        <!-- å³å´ï¼šæ‰£æ¬¾èˆ‡ä¿éšª -->
        <div>
          <div class="section-header">ğŸ›¡ï¸ æ‰£æ¬¾èˆ‡ä¿éšª</div>
          <div class="form-group">
            <label class="form-label">è«‹å‡æ™‚æ•¸ (å°æ™‚)</label>
            <div class="input-wrapper">
              <input type="number" id="leaveHours" placeholder="0">
            </div>
          </div>
          <div class="grid-cols-2" style="gap: 10px;">
            <div class="form-group">
              <label class="form-label">å‹é€€è‡ªæ‰£ (%)</label>
              <div class="input-wrapper">
                <input type="number" id="pensionRate" placeholder="ä¾‹å¦‚ï¼š6">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">å¥ä¿çœ·å±¬äººæ•¸</label>
              <div class="input-wrapper">
                <input type="number" id="dependents" placeholder="0">
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">è£œå……ä¿è²»è¨ˆç®—åŸºæ•¸</label>
            <div class="input-wrapper">
              <input type="number" id="supplementaryPremium" placeholder="å¡«å¯«ç¬¬äºŒé çé‡‘ç¸½é¡">
            </div>
          </div>
        </div>
      </div>

      <!-- éš±è—çš„è¨ˆç®—æ¬„ä½ (ä¿ç•™é‚è¼¯ä½†ä¸é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çœ‹å¤ªé›œ) -->
      <div style="display:none;">
        <input id="ot2h"><input id="ot3to4h"><input id="ot5to6h">
        <input id="sat2h"><input id="sat3to8h"><input id="sat9to12h">
        <input id="holidayHours">
      </div>

      <div style="margin-top: 2rem;">
        <button class="btn btn-primary" onclick="calculate()">
          <span style="font-size: 1.2rem;">ğŸ§®</span> ç«‹å³è¨ˆç®—è–ªè³‡
        </button>
      </div>
    </div>

    <!-- 4. çµæœé¡¯ç¤ºå€ -->
    <div id="resultArea" style="display: none;">
      <div class="payslip">
        <div class="payslip-header">
          <h3>æœ¬æœˆå¯¦é ˜è–ªè³‡</h3>
          <div class="amount" id="finalNetPay">NT$ 0</div>
          <p style="color: var(--text-sub); font-size: 0.9rem;">å«åŠ ç­è²»èˆ‡å„é …æ‰£æ¬¾</p>
        </div>
        
        <div class="payslip-body">
          <!-- æ‡‰ç™¼é …ç›® -->
          <div class="payslip-section income">
            <h4>æ‡‰ç™¼é …ç›® (Income)</h4>
            <div class="payslip-row"><span class="key">æ™‚è–ªåŸºæº–</span><span class="val" id="resHourly">0</span></div>
            <div class="payslip-row"><span class="key">å¹³æ—¥åŠ ç­è²»</span><span class="val text-green" id="resWD">0</span></div>
            <div class="payslip-row"><span class="key">é€±å…­åŠ ç­è²»</span><span class="val text-green" id="resSat">0</span></div>
            <div class="payslip-row"><span class="key">ç¯€æ—¥åŠ ç­è²»</span><span class="val text-green" id="resHoliday">0</span></div>
            <div class="payslip-row"><span class="key">å¹³æ—¥èª¤é¤è²»</span><span class="val" id="resMealWD">0</span></div>
            <div class="payslip-row"><span class="key">é€±å…­èª¤é¤è²»</span><span class="val" id="resMealSat">0</span></div>
            <div class="payslip-row"><span class="key">ç¯€æ—¥èª¤é¤è²»</span><span class="val" id="resMealHoliday">0</span></div>
            <div id="bonusRow"></div>
            
            <div class="payslip-row total">
              <span class="key">åŠ ç­ç¸½è¨ˆ</span>
              <span class="val" id="resTotalAdd">0</span>
            </div>
          </div>

          <!-- æ‡‰æ‰£é …ç›® -->
          <div class="payslip-section">
            <h4>æ‡‰æ‰£é …ç›® (Deductions)</h4>
            <div class="payslip-row"><span class="key">å‹ä¿è²»</span><span class="val text-red" id="dedLabor">0</span></div>
            <div class="payslip-row"><span class="key">å¥ä¿è²» (æœ¬äºº)</span><span class="val text-red" id="dedHealthP">0</span></div>
            <div class="payslip-row"><span class="key">å¥ä¿è²» (çœ·å±¬)</span><span class="val text-red" id="dedHealthD">0</span></div>
            <div class="payslip-row"><span class="key">ç¦åˆ©é‡‘</span><span class="val text-red" id="dedWelfare">0</span></div>
            <div class="payslip-row"><span class="key">å‹é€€è‡ªæ</span><span class="val text-red" id="dedPension">0</span></div>
            <div class="payslip-row"><span class="key">äºŒä»£å¥ä¿è£œå……ä¿è²»</span><span class="val text-red" id="dedSup">0</span></div>
            <div class="payslip-row"><span class="key">è«‹å‡æ‰£æ¬¾</span><span class="val text-red" id="dedLeave">0</span></div>
            
            <div class="payslip-row total">
              <span class="key">æ‰£æ¬¾ç¸½è¨ˆ</span>
              <span class="val text-red" id="resTotalDed">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- å½ˆçª— -->
  <div class="modal-overlay" id="popupModal">
    <div class="modal-content">
      <div style="text-align: center; margin-bottom: 1.5rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¢</div>
        <h3 style="font-size: 1.5rem; color: var(--text-main);">ç³»çµ±å…¬å‘Š</h3>
      </div>
      <p id="popupText" style="color: var(--text-sub); margin-bottom: 2rem; line-height: 1.8; text-align: left;"></p>
      <button class="btn btn-primary" onclick="closePopup()">æˆ‘ç­è§£äº†</button>
    </div>
  </div>

  <script>
    /* --- è¨­å®šèˆ‡è³‡æ–™ --- */
    const popupConfig = {
      "content": "<b>10/21~11/20</b> æœˆä»½è–ªè³‡çµç®—ã€‚\nè«‹ä¾å¯¦éš›æ—¥æœŸå¡«å¯«åŠ ç­æ™‚æ•¸ï¼Œç³»çµ±æœƒè‡ªå‹•å°æ‡‰è²»ç‡ã€‚\nå¦‚æœ‰ç‰¹æ®Šç‹€æ³è«‹æ‰‹å‹•å‚™è¨»ã€‚",
      "range": { "start": "2025-10-21", "end": "2025-11-20" }
    };

    const holidays = {
      "2025-01-01": "å…ƒæ—¦", "2025-01-25": "å½ˆæ€§æ”¾å‡", "2025-01-27": "å½ˆæ€§æ”¾å‡", "2025-01-28": "é™¤å¤•",
      "2025-01-29": "æ˜¥ç¯€", "2025-01-30": "æ˜¥ç¯€", "2025-01-31": "æ˜¥ç¯€", "2025-02-28": "å’Œå¹³ç´€å¿µæ—¥",
      "2025-04-03": "å½ˆæ€§æ”¾å‡", "2025-04-04": "å…’ç«¥ç¯€/æ¸…æ˜", "2025-05-01": "å‹å‹•ç¯€", "2025-05-30": "å½ˆæ€§æ”¾å‡",
      "2025-05-31": "ç«¯åˆç¯€", "2025-09-28": "å­”å­èª•è¾°", "2025-09-29": "å½ˆæ€§æ”¾å‡", "2025-10-05": "å½ˆæ€§æ”¾å‡",
      "2025-10-06": "ä¸­ç§‹ç¯€", "2025-10-10": "åœ‹æ…¶æ—¥", "2025-10-24": "å½ˆæ€§æ”¾å‡", "2025-10-25": "å…‰å¾©ç¯€",
      "2025-12-25": "è¡Œæ†²ç´€å¿µæ—¥"
    };
    
    const typhoonHolidays = {
      "2025-07-06": "é¢±é¢¨å‡", "2025-07-07": "é¢±é¢¨å‡", "2025-08-13": "é¢±é¢¨å‡", "2025-11-12": "é¢±é¢¨å‡"
    };

    const makeupWorkdays = ["2025-02-08"]; // è£œç­æ—¥

    const insuranceTable = [
      { salary: 28590, labor: 715, health: 444 }, { salary: 28800, labor: 720, health: 447 },
      { salary: 30300, labor: 758, health: 470 }, { salary: 31800, labor: 795, health: 493 },
      { salary: 33300, labor: 833, health: 516 }, { salary: 34800, labor: 870, health: 540 },
      { salary: 36300, labor: 908, health: 563 }, { salary: 38200, labor: 955, health: 592 },
      { salary: 40100, labor: 1003, health: 622 }, { salary: 42000, labor: 1050, health: 651 },
      { salary: 43900, labor: 1098, health: 681 }, { salary: 45800, labor: 1145, health: 710 },
      { salary: 47700, labor: 1193, health: 740 }, { salary: 49600, labor: 1240, health: 769 },
      { salary: 51500, labor: 1288, health: 799 }, { salary: 53400, labor: 1335, health: 828 },
      { salary: 55300, labor: 1383, health: 858 }, { salary: 57200, labor: 1430, health: 887 },
      { salary: 59100, labor: 1478, health: 917 }, { salary: 61000, labor: 1525, health: 946 },
      { salary: 62900, labor: 1573, health: 976 }, { salary: 64800, labor: 1620, health: 1005 },
      { salary: 66700, labor: 1668, health: 1035 }, { salary: 68600, labor: 1715, health: 1064 },
      { salary: 70500, labor: 1763, health: 1094 }, { salary: 72400, labor: 1810, health: 1123 },
      { salary: 74300, labor: 1858, health: 1153 }, { salary: 76200, labor: 1905, health: 1182 },
      { salary: 78100, labor: 1953, health: 1212 }, { salary: 80000, labor: 2000, health: 1241 },
      { salary: 81900, labor: 2048, health: 1271 }, { salary: 83800, labor: 2095, health: 1300 },
      { salary: 85700, labor: 2143, health: 1330 }, { salary: 87600, labor: 2190, health: 1359 },
      { salary: 89500, labor: 2238, health: 1389 }
    ];

    /* --- æ ¸å¿ƒé‚è¼¯ --- */
    
    function generateCalendar() {
      const start = new Date(document.getElementById("startDate").value);
      const end = new Date(document.getElementById("endDate").value);
      const tbody = document.querySelector("#calendar tbody");
      tbody.innerHTML = "";

      if (isNaN(start) || isNaN(end) || start > end) {
        alert("è«‹ç¢ºèªæ—¥æœŸç¯„åœæ˜¯å¦æ­£ç¢º");
        return;
      }

      let currentRow = document.createElement("tr");
      let d = new Date(start);

      // è£œç™½
      for (let i = 0; i < d.getDay(); i++) {
        currentRow.appendChild(document.createElement("td"));
      }

      for (; d <= end; d.setDate(d.getDate() + 1)) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${yyyy}-${mm}-${dd}`;
        const weekday = d.getDay();

        let label = "å¹³æ—¥";
        let className = "cell-weekday";
        let dayType = "weekday";

        if ((weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key)) {
          label = "é€±æœ«";
          className = "cell-weekend";
          dayType = "weekend";
        }

        if (makeupWorkdays.includes(key)) {
          label = "è£œç­";
          className = "cell-festival"; // è£œç­è¦–åŒç¯€æ—¥è²»ç‡ç®—æ³•? åŸcodeé‚è¼¯çœ‹èµ·ä¾†è£œç­æ˜¯"festival"
          dayType = "holiday"; 
        }

        if (holidays[key]) {
          label = holidays[key];
          className = (weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key) ? "cell-weekend" : "cell-festival";
          dayType = "holiday";
        }

        if (typhoonHolidays[key]) {
          label = typhoonHolidays[key];
          className = "cell-weekend";
          dayType = "weekend";
        }

        const cell = document.createElement("td");
        cell.className = className;
        cell.innerHTML = `
          <span class="date-badge">${mm}/${dd}</span>
          <span class="type-badge">${label}</span>
          <input type="number" min="0" step="0.5" placeholder="-" data-daytype="${dayType}" onchange="updateTotal()" onkeyup="updateTotal()">
        `;
        currentRow.appendChild(cell);

        if (weekday === 6) {
          tbody.appendChild(currentRow);
          currentRow = document.createElement("tr");
        }
      }

      if (currentRow.children.length > 0) {
        while (currentRow.children.length < 7) currentRow.appendChild(document.createElement("td"));
        tbody.appendChild(currentRow);
      }

      document.getElementById("calendarCard").style.display = "block";
      // å¹³æ»‘æ»¾å‹•
      document.getElementById("calendarCard").scrollIntoView({ behavior: 'smooth', block: 'start' });
      updateTotal();
    }

    function updateTotal() {
      const inputs = document.querySelectorAll("td input[type='number']");
      let w2=0, w233=0, w266=0, s2=0, s233=0, s332=0, holiday=0;

      inputs.forEach(i => {
        const v = parseFloat(i.value) || 0;
        const type = i.dataset.daytype;
        if(v === 0) return;

        if (type === "weekday") {
          w2 += Math.min(v, 2);
          w233 += Math.min(Math.max(v - 2, 0), 2);
          w266 += Math.max(v - 4, 0);
        } else if (type === "weekend") {
          s2 += Math.min(v, 2);
          s233 += Math.min(Math.max(v - 2, 0), 6);
          s332 += Math.max(v - 8, 0);
        } else if (type === "holiday") {
          holiday += v;
        }
      });

      // å¯«å…¥éš±è—æ¬„ä½
      document.getElementById("ot2h").value = w2;
      document.getElementById("ot3to4h").value = w233;
      document.getElementById("ot5to6h").value = w266;
      document.getElementById("sat2h").value = s2;
      document.getElementById("sat3to8h").value = s233;
      document.getElementById("sat9to12h").value = s332;
      document.getElementById("holidayHours").value = holiday;

      const total = w2 + w233 + w266 + s2 + s233 + s332 + holiday;
      document.getElementById("otTotalHours").textContent = total.toFixed(1);
    }

    function parse(id) { return parseFloat(document.getElementById(id).value) || 0; }
    function formatCurrency(num) { return Math.round(num).toLocaleString(); }

    function calculate() {
      const base = parse("baseSalary");
      if (base === 0) { alert("è«‹è¼¸å…¥æœ¬è–ª"); return; }

      // 1. åŸºç¤åƒæ•¸
      const bonus = 2000;
      const meal = 1800;
      const extra = parse("extraPay");
      const totalBase = base + bonus + meal + extra;
      const hourly = totalBase / 30 / 8;

      // 2. ä¿éšª
      const ins = insuranceTable.find(row => totalBase <= row.salary) || insuranceTable[insuranceTable.length - 1];
      const labor = ins.labor;
      const personalHealth = ins.health;
      const dependents = parse("dependents");
      const dependentHealth = personalHealth * dependents;
      
      // 3. æ‰£é …
      const pension = Math.round(ins.salary * (parse("pensionRate")/100));
      const welfare = Math.round((base + bonus + extra) * 0.005);
      const supPremium = Math.round(parse("supplementaryPremium") * 0.0211);
      const leaveDeduct = parse("leaveHours") * hourly;

      // 4. åŠ ç­è²»
      const ot1 = parse("ot2h");
      const ot2 = parse("ot3to4h");
      const ot3 = parse("ot5to6h");
      const s1 = parse("sat2h");
      const s2 = parse("sat3to8h");
      const s3 = parse("sat9to12h");
      const h1 = parse("holidayHours");

      const payWD = (ot1 * 2 + ot2 * 2.33 + ot3 * 2.66) * hourly;
      const paySat = (s1 * 2 + s2 * 2.33 + s3 * 3.32) * hourly;
      const payHoliday = h1 * 2.16 * hourly;

      // 5. èª¤é¤è²»èˆ‡çé‡‘
      const mealWD = Math.ceil(ot1 % 2 === 0 ? ot1 / 2 : (Math.floor(ot1) + 1) / 2) * 60;
      const mealSat = Math.floor((s1 + s2) / 8) * 60;
      const mealH = Math.ceil(h1 / 8) * 60;
      
      const otTotal = ot1 + ot2 + ot3 + s1 + s2 + s3 + h1;
      let otBonus = 0;
      if (otTotal >= 50) otBonus = 3000;
      else if (otTotal >= 40) otBonus = 2000;
      else if (otTotal >= 30) otBonus = 1500;

      // 6. ç¸½è¨ˆ
      const totalAdd = payWD + paySat + payHoliday + mealWD + mealSat + mealH + otBonus;
      const totalDed = labor + personalHealth + dependentHealth + welfare + pension + supPremium + leaveDeduct;
      const net = totalBase + totalAdd - totalDed;

      // 7. æ›´æ–° UI
      document.getElementById("resHourly").textContent = hourly.toFixed(2);
      document.getElementById("resWD").textContent = formatCurrency(payWD);
      document.getElementById("resSat").textContent = formatCurrency(paySat);
      document.getElementById("resHoliday").textContent = formatCurrency(payHoliday);
      document.getElementById("resMealWD").textContent = mealWD;
      document.getElementById("resMealSat").textContent = mealSat;
      document.getElementById("resMealHoliday").textContent = mealH;
      document.getElementById("resTotalAdd").textContent = formatCurrency(totalAdd);

      // çé‡‘é¡¯ç¤º
      const bonusRow = document.getElementById("bonusRow");
      if(otBonus > 0) {
        bonusRow.innerHTML = `<div class="payslip-row"><span class="key">åŠ ç­æ™‚æ•¸çé‡‘</span><span class="val text-green">${formatCurrency(otBonus)}</span></div>`;
      } else {
        bonusRow.innerHTML = "";
      }

      document.getElementById("dedLabor").textContent = formatCurrency(labor);
      document.getElementById("dedHealthP").textContent = formatCurrency(personalHealth);
      document.getElementById("dedHealthD").textContent = formatCurrency(dependentHealth);
      document.getElementById("dedWelfare").textContent = formatCurrency(welfare);
      document.getElementById("dedPension").textContent = formatCurrency(pension);
      document.getElementById("dedSup").textContent = formatCurrency(supPremium);
      document.getElementById("dedLeave").textContent = formatCurrency(leaveDeduct);
      document.getElementById("resTotalDed").textContent = formatCurrency(totalDed);

      document.getElementById("finalNetPay").textContent = "NT$ " + formatCurrency(net);

      // é¡¯ç¤ºçµæœå€
      const resArea = document.getElementById("resultArea");
      resArea.style.display = "block";
      resArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /* --- å½ˆçª—é‚è¼¯ --- */
    function closePopup() {
      document.getElementById("popupModal").classList.remove("active");
    }

    window.addEventListener('DOMContentLoaded', function() {
      document.getElementById("popupText").innerHTML = popupConfig.content.replace(/\n/g, "<br>");
      document.getElementById("startDate").value = popupConfig.range.start;
      document.getElementById("endDate").value = popupConfig.range.end;
      
      setTimeout(() => {
        document.getElementById("popupModal").classList.add("active");
      }, 500);
    });
  </script>
</body>
</html>