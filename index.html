<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="å°ˆæ¥­çš„è–ªè³‡è¨ˆç®—èˆ‡ç®¡ç†ç³»çµ±ï¼Œæ”¯æ´åŠ ç­è²»è¨ˆç®—ã€è«‹å‡ç®¡ç†ç­‰åŠŸèƒ½">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="è–ªè³‡ç®¡ç†">
  
  <title>å¤§ç‘ç§‘æŠ€ | è–ªè³‡ç®¡ç†ç³»çµ±</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
  <link rel="apple-touch-icon" href="./icon-192.png">
  
  <!-- Google Fonts - ç²¾é¸å­—é«”çµ„åˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      /* ä¸»è‰²èª¿ - å°ˆæ¥­ä¼æ¥­è— */
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1e40af;
      --primary-glow: rgba(37, 99, 235, 0.1);
      
      /* è¼”åŠ©è‰² */
      --success: #10b981;
      --success-light: #d1fae5;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --danger: #ef4444;
      --danger-light: #fee2e2;
      
      /* ä¸­æ€§è‰² - å°ˆæ¥­ç°éš */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #94a3b8;
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      
      /* å°ºå¯¸èˆ‡åœ“è§’ */
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      
      /* é™°å½± - æ›´ç²¾ç·» */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      /* å‹•ç•« */
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* èƒŒæ™¯è£é£¾ - æ›´ç°¡æ½” */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 320px;
      background: linear-gradient(180deg, rgba(37, 99, 235, 0.02) 0%, transparent 100%);
      pointer-events: none;
      z-index: -1;
    }

    /* ===== Header ===== */
    .header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
      padding: 2.5rem 1.5rem 3.5rem;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse 60% 40% at 20% 30%, rgba(37, 99, 235, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse 50% 30% at 80% 70%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
      pointer-events: none;
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(to top, var(--bg-primary), transparent);
      pointer-events: none;
    }

    .header-content {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }

    .header-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
      letter-spacing: 0.3px;
      margin-bottom: 1rem;
      animation: fadeInDown 0.6s var(--ease-out);
    }

    .header-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .header h1 {
      font-size: clamp(1.875rem, 4vw, 2.5rem);
      font-weight: 700;
      color: #ffffff;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
      animation: fadeInDown 0.6s var(--ease-out) 0.1s both;
    }

    .header p {
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.75);
      font-weight: 400;
      animation: fadeInDown 0.6s var(--ease-out) 0.2s both;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Main Container ===== */
    .main {
      max-width: 1200px;
      margin: -2rem auto 4rem;
      padding: 0 1.5rem;
      position: relative;
      z-index: 10;
    }

    /* ===== Card ===== */
    .card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      margin-bottom: 1.5rem;
      animation: fadeInUp 0.5s var(--ease-out) both;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--border);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: linear-gradient(to bottom, rgba(248, 250, 252, 0.5), transparent);
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.125rem;
      flex-shrink: 0;
      background: var(--bg-tertiary);
    }

    .card-icon.blue {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      color: var(--primary);
    }

    .card-icon.green {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      color: var(--success);
    }

    .card-icon.orange {
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      color: var(--warning);
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }

    .card-subtitle {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-top: 4px;
      font-weight: 400;
    }

    .card-body {
      padding: 1.5rem;
    }

    @media (max-width: 768px) {
      .card-body {
        padding: 1.25rem;
      }
    }

    /* ===== Grid ===== */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
    }

    @media (max-width: 640px) {
      .grid-2 { grid-template-columns: 1fr; }
    }

    /* ===== Form Elements ===== */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-group.compact {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      letter-spacing: -0.01em;
    }

    .form-input {
      width: 100%;
      padding: 0.625rem 0.875rem;
      font-size: 0.875rem;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
      appearance: none;
    }

    .form-input:hover {
      border-color: #cbd5e1;
      background: #fafbfc;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
      background: var(--bg-secondary);
    }

    .form-input::placeholder {
      color: var(--text-tertiary);
    }

    .form-input[readonly] {
      background: var(--bg-tertiary);
      color: var(--text-tertiary);
      cursor: not-allowed;
      border-color: transparent;
    }

    .input-group {
      position: relative;
    }

    .input-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      font-size: 0.875rem;
      pointer-events: none;
    }

    /* ===== Section Label ===== */
    .section-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(to right, var(--border), transparent);
    }

    /* ===== Button ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s var(--ease-out);
      width: 100%;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      font-weight: 500;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:active {
      transform: scale(0.98);
    }

    .btn-icon {
      font-size: 1.125rem;
    }

    /* ===== Calendar ===== */
    .calendar-wrapper {
      overflow-x: auto;
      margin: -0.5rem;
      padding: 0.5rem;
      border-radius: var(--radius-md);
    }

    .calendar {
      width: 100%;
      min-width: 720px;
      border-collapse: separate;
      border-spacing: 4px;
    }

    .calendar th {
      padding: 0.75rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-tertiary);
      text-align: center;
    }

    .calendar td {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      padding: 0.625rem;
      vertical-align: top;
      min-width: 100px;
      transition: all 0.2s ease;
    }

    .calendar td:hover {
      border-color: var(--border);
    }

    .calendar td.empty {
      background: transparent;
      border-color: transparent;
    }

    .day-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .day-date {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .day-badge {
      font-size: 0.625rem;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* å¹³æ—¥ */
    .cell-weekday .day-badge {
      background: var(--bg-tertiary);
      color: var(--text-tertiary);
    }

    /* é€±æœ« */
    .cell-weekend {
      background: linear-gradient(135deg, #fff5f5 0%, #fff0f0 100%) !important;
    }

    .cell-weekend .day-date {
      color: var(--danger);
    }

    .cell-weekend .day-badge {
      background: var(--danger-light);
      color: var(--danger);
    }

    /* ç¯€æ—¥/å‡æ—¥ */
    .cell-festival {
      background: linear-gradient(135deg, #fffaf0 0%, #fff5e6 100%) !important;
    }

    .cell-festival .day-date {
      color: var(--warning);
    }

    .cell-festival .day-badge {
      background: var(--warning-light);
      color: #c67700;
    }

    .day-input {
      width: 100%;
      padding: 0.5rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      text-align: center;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all 0.2s ease;
    }

    .day-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    .day-input::placeholder {
      color: var(--text-tertiary);
    }

    /* ç¸½æ™‚æ•¸é¡¯ç¤º */
    .total-hours {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 0 0;
      border-top: 1px dashed var(--border);
      margin-top: 1rem;
    }

    .total-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .total-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
    }

    .total-unit {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    /* ===== Note ===== */
    .note {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      margin-bottom: 1.25rem;
    }

    .note-icon {
      font-size: 1rem;
      flex-shrink: 0;
    }

    .note-text {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* ===== Result Area ===== */
    .payslip {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      overflow: hidden;
      animation: scaleIn 0.4s var(--ease-spring);
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .payslip-header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      padding: 2rem 1.75rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .payslip-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse 100% 100% at 50% 0%, rgba(37, 99, 235, 0.15) 0%, transparent 60%);
      pointer-events: none;
    }

    .payslip-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.5rem;
      position: relative;
    }

    .payslip-amount {
      font-family: 'JetBrains Mono', monospace;
      font-size: clamp(2rem, 6vw, 2.75rem);
      font-weight: 700;
      color: #fff;
      position: relative;
    }

    .payslip-subtitle {
      font-size: 0.8125rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 0.5rem;
      position: relative;
    }

    .payslip-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    @media (max-width: 640px) {
      .payslip-body { grid-template-columns: 1fr; }
    }

    .payslip-section {
      padding: 1.5rem 1.75rem;
    }

    .payslip-section:first-child {
      border-right: 1px solid var(--border-light);
    }

    @media (max-width: 640px) {
      .payslip-section:first-child {
        border-right: none;
        border-bottom: 1px solid var(--border-light);
      }
    }

    .payslip-section-title {
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border-light);
    }

    .payslip-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
    }

    .payslip-row .key {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .payslip-row .val {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .payslip-row.total {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px dashed var(--border);
    }

    .payslip-row.total .key,
    .payslip-row.total .val {
      font-weight: 700;
      color: var(--text-primary);
    }

    .text-success { color: var(--success); }
    .text-danger { color: var(--danger); }

    /* ===== Modal ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 22, 40, 0.7);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-secondary);
      width: 100%;
      max-width: 440px;
      border-radius: var(--radius-xl);
      padding: 2rem;
      box-shadow: var(--shadow-xl);
      transform: translateY(20px) scale(0.95);
      transition: transform 0.3s var(--ease-spring);
    }

    .modal-overlay.active .modal {
      transform: translateY(0) scale(1);
    }

    .modal-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1.5rem;
      background: linear-gradient(135deg, #e6f0ff 0%, #cce0ff 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
    }

    .modal-title {
      font-size: 1.375rem;
      font-weight: 700;
      color: var(--text-primary);
      text-align: center;
      margin-bottom: 1rem;
    }

    .modal-content {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 1.75rem;
    }

    .modal-content b {
      color: var(--primary);
      font-weight: 600;
    }

    /* ===== Hidden Inputs ===== */
    .hidden { display: none !important; }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .header {
        padding: 2rem 1rem 3rem;
      }
      
      .main {
        padding: 0 1rem;
      }
      
      .card-header {
        padding: 1.25rem 1.5rem;
      }
      
      .card-body {
        padding: 1.5rem;
      }
    }

    /* ===== Leave Types Grid ===== */
    .leave-types-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      padding: 1rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      margin-top: 0.5rem;
      border: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .leave-types-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .leave-types-grid {
        grid-template-columns: 1fr;
      }
    }

    .leave-type-item {
      display: flex;
      flex-direction: column;
    }

    .leave-type-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.375rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .leave-type-badge {
      font-size: 0.625rem;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }

    .leave-type-badge.full {
      background: var(--success-light);
      color: var(--success);
    }

    .leave-type-badge.half {
      background: var(--warning-light);
      color: var(--warning);
    }

    .leave-type-input {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      border: 1px solid var(--border);
    }

    .leave-type-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-glow);
    }

    /* ===== Utility ===== */
    .mt-sm { margin-top: 0.75rem; }
    .mt-md { margin-top: 1.5rem; }
    .mt-lg { margin-top: 2rem; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-badge">ç³»çµ±é‹ä½œä¸­</div>
      <h1>å¤§ç‘ç§‘æŠ€</h1>
      <p>è–ªè³‡è¨ˆç®—ç®¡ç†ç³»çµ±</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    
    <!-- 1. çµç®—é€±æœŸè¨­å®š -->
    <div class="card" style="animation-delay: 0.1s;">
      <div class="card-header">
        <div class="card-icon blue">ğŸ“…</div>
        <div>
          <div class="card-title">çµç®—é€±æœŸè¨­å®š</div>
          <div class="card-subtitle">é¸æ“‡è–ªè³‡è¨ˆç®—çš„æ—¥æœŸç¯„åœ</div>
        </div>
      </div>
      <div class="card-body">
        <div class="grid-2">
          <div class="form-group">
            <label class="form-label">é–‹å§‹æ—¥æœŸ</label>
            <input type="date" id="startDate" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">çµæŸæ—¥æœŸ</label>
            <input type="date" id="endDate" class="form-input">
          </div>
        </div>
        <div class="mt-md">
          <button class="btn btn-primary" onclick="generateCalendar()">
            <span class="btn-icon">ğŸ“‹</span>
            ç”ŸæˆåŠ ç­å¡«å¯«è¡¨
          </button>
        </div>
      </div>
    </div>

    <!-- 2. åŠ ç­å¡«å¯«å€ -->
    <div class="card hidden" id="calendarCard" style="animation-delay: 0.2s;">
      <div class="card-header">
        <div class="card-icon orange">â°</div>
        <div>
          <div class="card-title">åŠ ç­æ™‚æ•¸ç™»è¨˜</div>
          <div class="card-subtitle">ä¾å¯¦éš›æƒ…æ³å¡«å¯«æ¯æ—¥åŠ ç­æ™‚æ•¸</div>
        </div>
      </div>
      <div class="card-body">
        <div class="note">
          <span class="note-icon">ğŸ’¡</span>
          <span class="note-text">ç³»çµ±å°‡è‡ªå‹•åˆ¤æ–·å¹³æ—¥ã€å‡æ—¥èˆ‡ç¯€æ—¥è²»ç‡ï¼Œè«‹ä¾ç…§æ¯æ—¥å¯¦éš›ç‹€æ³å¡«å¯«åŠ ç­æ™‚æ•¸ã€‚</span>
        </div>
        
        <div class="calendar-wrapper">
          <table class="calendar" id="calendar">
            <thead>
              <tr>
                <th>é€±æ—¥</th>
                <th>é€±ä¸€</th>
                <th>é€±äºŒ</th>
                <th>é€±ä¸‰</th>
                <th>é€±å››</th>
                <th>é€±äº”</th>
                <th>é€±å…­</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="total-hours">
          <span class="total-label">ç›®å‰ç™»è¨˜ç¸½æ™‚æ•¸</span>
          <span class="total-value" id="otTotalHours">0.0</span>
          <span class="total-unit">å°æ™‚</span>
        </div>
      </div>
    </div>

    <!-- 3. è–ªè³‡åƒæ•¸é…ç½® -->
    <div class="card" style="animation-delay: 0.3s;">
      <div class="card-header">
        <div class="card-icon green">âš™ï¸</div>
        <div>
          <div class="card-title">è–ªè³‡åƒæ•¸é…ç½®</div>
          <div class="card-subtitle">è¨­å®šè–ªè³‡çµæ§‹èˆ‡æ‰£æ¬¾é …ç›®</div>
        </div>
      </div>
      <div class="card-body">
        <div class="grid-2">
          <!-- å·¦å´ï¼šæ”¶å…¥ -->
          <div>
            <div class="section-label">ğŸ’° æ”¶å…¥åƒæ•¸</div>
            
            <div class="form-group">
              <label class="form-label">æœ¬è–ªï¼ˆæœˆè–ªï¼‰</label>
              <input type="number" id="baseSalary" class="form-input" placeholder="è«‹è¼¸å…¥æœ¬è–ªé‡‘é¡">
            </div>
            
            <div class="grid-2" style="gap: 0.75rem;">
              <div class="form-group">
                <label class="form-label">å…¨å‹¤çé‡‘</label>
                <div class="input-group">
                  <input type="number" id="bonus" class="form-input" value="2000" readonly>
                  <span class="input-icon">ğŸ”’</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ä¼™é£Ÿè²»</label>
                <div class="input-group">
                  <input type="number" id="meal" class="form-input" value="1800" readonly>
                  <span class="input-icon">ğŸ”’</span>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">å…¶ä»–æ´¥è²¼</label>
              <input type="number" id="extraPay" class="form-input" placeholder="ä¾‹å¦‚ï¼šè·å‹™åŠ çµ¦ã€äº¤é€šæ´¥è²¼">
            </div>
          </div>

          <!-- å³å´ï¼šæ‰£æ¬¾ -->
          <div>
            <div class="section-label">ğŸ›¡ï¸ æ‰£æ¬¾èˆ‡ä¿éšª</div>
            
            <div class="form-group">
              <label class="form-label">è«‹å‡æ™‚æ•¸ï¼ˆå°æ™‚ï¼‰</label>
              <div class="leave-types-grid">
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    äº‹å‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leavePersonal" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    ç—…å‡
                    <span class="leave-type-badge half">åŠè–ª</span>
                  </div>
                  <input type="number" id="leaveSick" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    å©šå‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leaveMarriage" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    å–ªå‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leaveBereavement" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    ç”¢å‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leaveMaternity" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    é™ªç”¢å‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leavePaternity" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
                <div class="leave-type-item">
                  <div class="leave-type-label">
                    å®¶åº­ç…§é¡§å‡
                    <span class="leave-type-badge full">å…¨è–ª</span>
                  </div>
                  <input type="number" id="leaveFamilyCare" class="form-input leave-type-input" placeholder="0" min="0" step="0.5">
                </div>
              </div>
            </div>
            
            <div class="grid-2" style="gap: 0.75rem;">
              <div class="form-group compact">
                <label class="form-label">å‹é€€è‡ªæï¼ˆ%ï¼‰</label>
                <input type="number" id="pensionRate" class="form-input" placeholder="0 ~ 6">
              </div>
              <div class="form-group compact">
                <label class="form-label">å¥ä¿çœ·å±¬äººæ•¸</label>
                <input type="number" id="dependents" class="form-input" placeholder="0">
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">è£œå……ä¿è²»è¨ˆç®—åŸºæ•¸</label>
              <input type="number" id="supplementaryPremium" class="form-input" placeholder="å¡«å¯«ç¬¬äºŒé çé‡‘ç¸½é¡">
            </div>
          </div>
        </div>

        <!-- éš±è—æ¬„ä½ -->
        <div class="hidden">
          <input id="ot2h"><input id="ot3to4h"><input id="ot5to6h">
          <input id="sat2h"><input id="sat3to8h"><input id="sat9to12h">
          <input id="holidayHours">
        </div>

        <div class="mt-lg">
          <button class="btn btn-primary" onclick="calculate()">
            <span class="btn-icon">ğŸ§®</span>
            ç«‹å³è¨ˆç®—è–ªè³‡
          </button>
        </div>
      </div>
    </div>

    <!-- 4. çµæœå€åŸŸ -->
    <div id="resultArea" class="hidden">
      <div class="payslip">
        <div class="payslip-header">
          <div class="payslip-title">æœ¬æœˆå¯¦é ˜è–ªè³‡</div>
          <div class="payslip-amount" id="finalNetPay">NT$ 0</div>
          <div class="payslip-subtitle">å«åŠ ç­è²»èˆ‡å„é …æ‰£æ¬¾</div>
        </div>
        
        <div class="payslip-body">
          <!-- æ‡‰ç™¼é …ç›® -->
          <div class="payslip-section">
            <div class="payslip-section-title">æ‡‰ç™¼é …ç›® Income</div>
            <div class="payslip-row">
              <span class="key">æ™‚è–ªåŸºæº–</span>
              <span class="val" id="resHourly">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">å¹³æ—¥åŠ ç­è²»</span>
              <span class="val text-success" id="resWD">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">é€±å…­åŠ ç­è²»</span>
              <span class="val text-success" id="resSat">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">ç¯€æ—¥åŠ ç­è²»</span>
              <span class="val text-success" id="resHoliday">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">å¹³æ—¥èª¤é¤è²»</span>
              <span class="val" id="resMealWD">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">é€±å…­èª¤é¤è²»</span>
              <span class="val" id="resMealSat">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">ç¯€æ—¥èª¤é¤è²»</span>
              <span class="val" id="resMealHoliday">0</span>
            </div>
            <div id="bonusRow"></div>
            <div class="payslip-row total">
              <span class="key">åŠ ç­ç¸½è¨ˆ</span>
              <span class="val" id="resTotalAdd">0</span>
            </div>
          </div>

          <!-- æ‡‰æ‰£é …ç›® -->
          <div class="payslip-section">
            <div class="payslip-section-title">æ‡‰æ‰£é …ç›® Deductions</div>
            <div class="payslip-row">
              <span class="key">å‹ä¿è²»</span>
              <span class="val text-danger" id="dedLabor">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">å¥ä¿è²»ï¼ˆæœ¬äººï¼‰</span>
              <span class="val text-danger" id="dedHealthP">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">å¥ä¿è²»ï¼ˆçœ·å±¬ï¼‰</span>
              <span class="val text-danger" id="dedHealthD">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">ç¦åˆ©é‡‘</span>
              <span class="val text-danger" id="dedWelfare">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">å‹é€€è‡ªæ</span>
              <span class="val text-danger" id="dedPension">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">äºŒä»£å¥ä¿è£œå……ä¿è²»</span>
              <span class="val text-danger" id="dedSup">0</span>
            </div>
            <div class="payslip-row">
              <span class="key">è«‹å‡æ‰£æ¬¾</span>
              <span class="val text-danger" id="dedLeave">0</span>
            </div>
            <div class="payslip-row" id="dedBonusRow" style="display: none;">
              <span class="key">å…¨å‹¤çé‡‘æ‰£é™¤</span>
              <span class="val text-danger" id="dedBonus">0</span>
            </div>
            <div class="payslip-row total">
              <span class="key">æ‰£æ¬¾ç¸½è¨ˆ</span>
              <span class="val text-danger" id="resTotalDed">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Modal -->
  <div class="modal-overlay" id="popupModal">
    <div class="modal">
      <div class="modal-icon">ğŸ“¢</div>
      <div class="modal-title">ç³»çµ±å…¬å‘Š</div>
      <div class="modal-content" id="popupText"></div>
      <button class="btn btn-primary" onclick="closePopup()">æˆ‘ç­è§£äº†</button>
    </div>
  </div>

  <script>
    /* === è¨­å®šèˆ‡è³‡æ–™ === */
    
    // è‡ªå‹•è¨ˆç®—çµç®—å€é–“çš„å‡½æ•¸
    function calculateSettlementPeriod() {
      const today = new Date();
      const currentDay = today.getDate();
      const currentMonth = today.getMonth(); // 0-11
      const currentYear = today.getFullYear();
      
      // è¨ˆç®—ä¸‹å€‹æœˆ7è™Ÿæ˜¯æ˜ŸæœŸå¹¾ï¼ˆç”¨ä¾†åˆ¤æ–·ä¸‹å€‹æœˆçš„çµç®—æ—¥ï¼‰
      let nextMonth = currentMonth + 1;
      let nextYear = currentYear;
      if (nextMonth > 11) {
        nextMonth = 0;
        nextYear += 1;
      }
      const nextDay7 = new Date(nextYear, nextMonth, 7);
      const nextDay7WeekDay = nextDay7.getDay();
      
      // è¨ˆç®—ä¸‹å€‹æœˆçš„å¯¦éš›çµç®—æ—¥ï¼ˆ7è™Ÿè‹¥æ˜¯å…­æ—¥ï¼Œè‡ªå‹•æ”¹æˆé€±äº”ï¼‰
      let nextSettlementDay = 7;
      if (nextDay7WeekDay === 6) {
        nextSettlementDay = 5;
      } else if (nextDay7WeekDay === 0) {
        nextSettlementDay = 6;
      }
      
      // è¨ˆç®—ç•¶æœˆ7è™Ÿæ˜¯æ˜ŸæœŸå¹¾
      const day7 = new Date(currentYear, currentMonth, 7);
      const day7WeekDay = day7.getDay();
      
      // è¨ˆç®—ç•¶æœˆçš„å¯¦éš›çµç®—æ—¥ï¼ˆ7è™Ÿè‹¥æ˜¯å…­æ—¥ï¼Œè‡ªå‹•æ”¹æˆé€±äº”ï¼‰
      let settlementDay = 7;
      if (day7WeekDay === 6) {
        settlementDay = 5;
      } else if (day7WeekDay === 0) {
        settlementDay = 6;
      }
      
      let startYear, startMonth, endYear, endMonth;
      
      // çµç®—æ—¥å‰ï¼ˆå«çµç®—æ—¥ï¼‰ï¼šé¡¯ç¤ºã€Œä¸Šä¸Šå€‹æœˆ21æ—¥ï½ä¸Šå€‹æœˆ20æ—¥ã€ï¼ˆæœ¬æœˆè¦çµç®—çš„ï¼‰
      // çµç®—æ—¥å¾Œåˆ°ä¸‹å€‹æœˆçµç®—æ—¥å‰ï¼šä»é¡¯ç¤ºæœ¬æœˆçµç®—çš„å€é–“
      // çµæŸæ—¥æœŸï¼šä¸Šå€‹æœˆ20æ—¥
      endMonth = currentMonth - 1;
      endYear = currentYear;
      if (endMonth < 0) {
        endMonth += 12;
        endYear -= 1;
      }
      
      // é–‹å§‹æ—¥æœŸï¼šä¸Šä¸Šå€‹æœˆ21æ—¥
      startMonth = currentMonth - 2;
      startYear = currentYear;
      if (startMonth < 0) {
        startMonth += 12;
        startYear -= 1;
      }
      
      const startDate = new Date(startYear, startMonth, 21);
      const endDate = new Date(endYear, endMonth, 20);
      
      // æ ¼å¼åŒ–ç‚º YYYY-MM-DD
      function formatDate(date) {
        const yyyy = date.getFullYear();
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const dd = String(date.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
      }
      
      // æ ¼å¼åŒ–ç‚º MM/DD é¡¯ç¤ºç”¨
      function formatDisplay(date) {
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const dd = String(date.getDate()).padStart(2, '0');
        return `${mm}/${dd}`;
      }
      
      return {
        start: formatDate(startDate),
        end: formatDate(endDate),
        displayStart: formatDisplay(startDate),
        displayEnd: formatDisplay(endDate)
      };
    }
    
    // æ ¹æ“šç•¶å‰æ—¥æœŸè‡ªå‹•è¨ˆç®—çµç®—å€é–“
    const settlementPeriod = calculateSettlementPeriod();
    
    const popupConfig = {
      content: `<b>${settlementPeriod.displayStart}~${settlementPeriod.displayEnd}</b> æœˆä»½è–ªè³‡çµç®—ã€‚\nè«‹ä¾å¯¦éš›æ—¥æœŸå¡«å¯«åŠ ç­æ™‚æ•¸ï¼Œç³»çµ±æœƒè‡ªå‹•å°æ‡‰è²»ç‡ã€‚\nå¦‚æœ‰ç‰¹æ®Šç‹€æ³è«‹æ‰‹å‹•å‚™è¨»ã€‚\n\n<span style="display:inline-block;background:#fef3c7;color:#92400e;padding:6px 12px;border-radius:6px;font-size:0.875rem;font-weight:500;">âš ï¸ è‹¥çµç®—æ—¥æœŸæœ‰è®Šè«‹æ‰‹å‹•èª¿æ•´æ—¥æœŸå€é–“</span>`,
      range: { start: settlementPeriod.start, end: settlementPeriod.end }
    };

    const holidays = {
      // 2025å¹´åœ‹å®šå‡æ—¥
      "2025-12-25": "è¡Œæ†²ç´€å¿µæ—¥",
      // 2026å¹´åœ‹å®šå‡æ—¥
      "2026-01-01": "å…ƒæ—¦",
      // æ˜¥ç¯€é€£å‡ï¼š2/14(å…­) ~ 2/22(æ—¥)
      "2026-02-14": "æ˜¥ç¯€", "2026-02-15": "æ˜¥ç¯€", "2026-02-16": "æ˜¥ç¯€", "2026-02-17": "æ˜¥ç¯€",
      "2026-02-18": "æ˜¥ç¯€", "2026-02-19": "æ˜¥ç¯€", "2026-02-20": "æ˜¥ç¯€", "2026-02-21": "æ˜¥ç¯€", "2026-02-22": "æ˜¥ç¯€",
      // 228å’Œå¹³ç´€å¿µæ—¥é€£å‡ï¼š2/27(äº”) ~ 3/1(æ—¥)
      "2026-02-27": "å’Œå¹³ç´€å¿µæ—¥", "2026-02-28": "å’Œå¹³ç´€å¿µæ—¥", "2026-03-01": "å’Œå¹³ç´€å¿µæ—¥",
      // å…’ç«¥ç¯€/æ¸…æ˜ç¯€é€£å‡ï¼š4/3(äº”) ~ 4/6(ä¸€)
      "2026-04-03": "å…’ç«¥ç¯€/æ¸…æ˜", "2026-04-04": "å…’ç«¥ç¯€/æ¸…æ˜", "2026-04-05": "å…’ç«¥ç¯€/æ¸…æ˜", "2026-04-06": "å…’ç«¥ç¯€/æ¸…æ˜",
      // å‹å‹•ç¯€é€£å‡ï¼š5/1(äº”) ~ 5/3(æ—¥)
      "2026-05-01": "å‹å‹•ç¯€", "2026-05-02": "å‹å‹•ç¯€", "2026-05-03": "å‹å‹•ç¯€",
      // ç«¯åˆç¯€é€£å‡ï¼š6/19(äº”) ~ 6/21(æ—¥)
      "2026-06-19": "ç«¯åˆç¯€", "2026-06-20": "ç«¯åˆç¯€", "2026-06-21": "ç«¯åˆç¯€",
      // ä¸­ç§‹ç¯€/æ•™å¸«ç¯€é€£å‡ï¼š9/25(äº”) ~ 9/28(ä¸€)
      "2026-09-25": "ä¸­ç§‹ç¯€", "2026-09-26": "ä¸­ç§‹ç¯€", "2026-09-27": "ä¸­ç§‹ç¯€", "2026-09-28": "ä¸­ç§‹ç¯€/æ•™å¸«ç¯€",
      // åœ‹æ…¶æ—¥é€£å‡ï¼š10/9(äº”) ~ 10/11(æ—¥)
      "2026-10-09": "åœ‹æ…¶æ—¥", "2026-10-10": "åœ‹æ…¶æ—¥", "2026-10-11": "åœ‹æ…¶æ—¥",
      // å…‰å¾©ç¯€é€£å‡ï¼š10/24(å…­) ~ 10/26(ä¸€)
      "2026-10-24": "å…‰å¾©ç¯€", "2026-10-25": "å…‰å¾©ç¯€", "2026-10-26": "å…‰å¾©ç¯€",
      // è¡Œæ†²ç´€å¿µæ—¥é€£å‡ï¼š12/25(äº”) ~ 12/27(æ—¥)
      "2026-12-25": "è¡Œæ†²ç´€å¿µæ—¥", "2026-12-26": "è¡Œæ†²ç´€å¿µæ—¥", "2026-12-27": "è¡Œæ†²ç´€å¿µæ—¥"
    };
    
    const typhoonHolidays = {
      // 2026å¹´é¢±é¢¨å‡ï¼ˆå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œæ–°å¢ï¼‰
    };

    const makeupWorkdays = [];

    const insuranceTable = [
      { salary: 28590, labor: 715, health: 444 }, { salary: 28800, labor: 720, health: 447 },
      { salary: 30300, labor: 758, health: 470 }, { salary: 31800, labor: 795, health: 493 },
      { salary: 33300, labor: 833, health: 516 }, { salary: 34800, labor: 870, health: 540 },
      { salary: 36300, labor: 908, health: 563 }, { salary: 38200, labor: 955, health: 592 },
      { salary: 40100, labor: 1003, health: 622 }, { salary: 42000, labor: 1050, health: 651 },
      { salary: 43900, labor: 1098, health: 681 }, { salary: 45800, labor: 1145, health: 710 },
      { salary: 47700, labor: 1193, health: 740 }, { salary: 49600, labor: 1240, health: 769 },
      { salary: 51500, labor: 1288, health: 799 }, { salary: 53400, labor: 1335, health: 828 },
      { salary: 55300, labor: 1383, health: 858 }, { salary: 57200, labor: 1430, health: 887 },
      { salary: 59100, labor: 1478, health: 917 }, { salary: 61000, labor: 1525, health: 946 },
      { salary: 62900, labor: 1573, health: 976 }, { salary: 64800, labor: 1620, health: 1005 },
      { salary: 66700, labor: 1668, health: 1035 }, { salary: 68600, labor: 1715, health: 1064 },
      { salary: 70500, labor: 1763, health: 1094 }, { salary: 72400, labor: 1810, health: 1123 },
      { salary: 74300, labor: 1858, health: 1153 }, { salary: 76200, labor: 1905, health: 1182 },
      { salary: 78100, labor: 1953, health: 1212 }, { salary: 80000, labor: 2000, health: 1241 },
      { salary: 81900, labor: 2048, health: 1271 }, { salary: 83800, labor: 2095, health: 1300 },
      { salary: 85700, labor: 2143, health: 1330 }, { salary: 87600, labor: 2190, health: 1359 },
      { salary: 89500, labor: 2238, health: 1389 }
    ];

    /* === æ ¸å¿ƒé‚è¼¯ === */
    
    function generateCalendar() {
      const start = new Date(document.getElementById("startDate").value);
      const end = new Date(document.getElementById("endDate").value);
      const tbody = document.querySelector("#calendar tbody");
      tbody.innerHTML = "";

      if (isNaN(start) || isNaN(end) || start > end) {
        alert("è«‹ç¢ºèªæ—¥æœŸç¯„åœæ˜¯å¦æ­£ç¢º");
        return;
      }

      let currentRow = document.createElement("tr");
      let d = new Date(start);

      // è£œç™½
      for (let i = 0; i < d.getDay(); i++) {
        const emptyCell = document.createElement("td");
        emptyCell.className = "empty";
        currentRow.appendChild(emptyCell);
      }

      for (; d <= end; d.setDate(d.getDate() + 1)) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${yyyy}-${mm}-${dd}`;
        const weekday = d.getDay();

        let label = "å¹³æ—¥";
        let className = "cell-weekday";
        let dayType = "weekday";

        if ((weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key)) {
          label = "é€±æœ«";
          className = "cell-weekend";
          dayType = "weekend";
        }

        if (makeupWorkdays.includes(key)) {
          label = "è£œç­";
          className = "cell-festival";
          dayType = "holiday"; 
        }

        if (holidays[key]) {
          label = holidays[key];
          className = (weekday === 0 || weekday === 6) && !makeupWorkdays.includes(key) ? "cell-weekend" : "cell-festival";
          dayType = "holiday";
        }

        if (typhoonHolidays[key]) {
          label = typhoonHolidays[key];
          className = "cell-weekend";
          dayType = "weekend";
        }

        const cell = document.createElement("td");
        cell.className = className;
        cell.innerHTML = `
          <div class="day-header">
            <span class="day-date">${mm}/${dd}</span>
            <span class="day-badge">${label}</span>
          </div>
          <input type="number" class="day-input" min="0" step="0.5" placeholder="â€”" data-daytype="${dayType}" onchange="updateTotal()" oninput="updateTotal()">
        `;
        currentRow.appendChild(cell);

        if (weekday === 6) {
          tbody.appendChild(currentRow);
          currentRow = document.createElement("tr");
        }
      }

      if (currentRow.children.length > 0) {
        while (currentRow.children.length < 7) {
          const emptyCell = document.createElement("td");
          emptyCell.className = "empty";
          currentRow.appendChild(emptyCell);
        }
        tbody.appendChild(currentRow);
      }

      const calendarCard = document.getElementById("calendarCard");
      calendarCard.classList.remove("hidden");
      calendarCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
      updateTotal();
    }

    function updateTotal() {
      const inputs = document.querySelectorAll("td input[type='number']");
      let w2=0, w233=0, w266=0, s2=0, s233=0, s332=0, holiday=0;

      inputs.forEach(i => {
        const v = parseFloat(i.value) || 0;
        const type = i.dataset.daytype;
        if(v === 0) return;

        if (type === "weekday") {
          w2 += Math.min(v, 2);
          w233 += Math.min(Math.max(v - 2, 0), 2);
          w266 += Math.max(v - 4, 0);
        } else if (type === "weekend") {
          s2 += Math.min(v, 2);
          s233 += Math.min(Math.max(v - 2, 0), 6);
          s332 += Math.max(v - 8, 0);
        } else if (type === "holiday") {
          holiday += v;
        }
      });

      document.getElementById("ot2h").value = w2;
      document.getElementById("ot3to4h").value = w233;
      document.getElementById("ot5to6h").value = w266;
      document.getElementById("sat2h").value = s2;
      document.getElementById("sat3to8h").value = s233;
      document.getElementById("sat9to12h").value = s332;
      document.getElementById("holidayHours").value = holiday;

      const total = w2 + w233 + w266 + s2 + s233 + s332 + holiday;
      document.getElementById("otTotalHours").textContent = total.toFixed(1);
    }

    function parse(id) { return parseFloat(document.getElementById(id).value) || 0; }
    function formatCurrency(num) { return Math.round(num).toLocaleString(); }

    function calculate() {
      const base = parse("baseSalary");
      if (base === 0) { alert("è«‹è¼¸å…¥æœ¬è–ª"); return; }

      // 1. åŸºç¤åƒæ•¸
      const bonusBase = 2000;
      const meal = 1800;
      const extra = parse("extraPay");
      
      // è¨ˆç®—è«‹å‡æ™‚æ•¸
      const leavePersonal = parse("leavePersonal");
      const leaveSick = parse("leaveSick");
      const leaveMarriage = parse("leaveMarriage");
      const leaveBereavement = parse("leaveBereavement");
      const leaveMaternity = parse("leaveMaternity");
      const leavePaternity = parse("leavePaternity");
      const leaveFamilyCare = parse("leaveFamilyCare");
      
      // å…¨å‹¤çé‡‘æ‰£é™¤ï¼ˆåªæœ‰äº‹å‡æ‰æ‰£ï¼Œä¾æ¯”ä¾‹ï¼‰
      const monthlyWorkHours = 30 * 8;
      const leaveRatio = Math.min(leavePersonal / monthlyWorkHours, 1);
      const bonusDeduct = Math.round(bonusBase * leaveRatio);
      const bonus = bonusBase - bonusDeduct;
      
      const totalBase = base + bonus + meal + extra;
      const hourly = totalBase / 30 / 8;

      // 2. ä¿éšª
      const ins = insuranceTable.find(row => totalBase <= row.salary) || insuranceTable[insuranceTable.length - 1];
      const labor = ins.labor;
      const personalHealth = ins.health;
      const dependents = parse("dependents");
      const dependentHealth = personalHealth * dependents;
      
      // 3. æ‰£é …
      const pension = Math.round(ins.salary * (parse("pensionRate")/100));
      const welfare = Math.round((base + bonus + extra) * 0.005);
      const supPremium = Math.round(parse("supplementaryPremium") * 0.0211);
      
      // è«‹å‡æ‰£æ¬¾è¨ˆç®—ï¼šç—…å‡åŠè–ªï¼Œå…¶ä»–å…¨è–ª
      const leaveDeduct = (leavePersonal + leaveMarriage + leaveBereavement + 
                          leaveMaternity + leavePaternity + leaveFamilyCare) * hourly +
                          leaveSick * hourly * 0.5;

      // 4. åŠ ç­è²»
      const ot1 = parse("ot2h");
      const ot2 = parse("ot3to4h");
      const ot3 = parse("ot5to6h");
      const s1 = parse("sat2h");
      const s2 = parse("sat3to8h");
      const s3 = parse("sat9to12h");
      const h1 = parse("holidayHours");

      const payWD = (ot1 * 2 + ot2 * 2.33 + ot3 * 2.66) * hourly;
      const paySat = (s1 * 2 + s2 * 2.33 + s3 * 3.32) * hourly;
      const payHoliday = h1 * 2.16 * hourly;

      // 5. èª¤é¤è²»èˆ‡çé‡‘
      const mealWD = Math.ceil(ot1 % 2 === 0 ? ot1 / 2 : (Math.floor(ot1) + 1) / 2) * 60;
      const mealSat = Math.floor((s1 + s2) / 8) * 60;
      const mealH = Math.ceil(h1 / 8) * 60;
      
      const otTotal = ot1 + ot2 + ot3 + s1 + s2 + s3 + h1;
      let otBonus = 0;
      if (otTotal >= 50) otBonus = 3000;
      else if (otTotal >= 40) otBonus = 2000;
      else if (otTotal >= 30) otBonus = 1500;

      // 6. ç¸½è¨ˆ
      const totalAdd = payWD + paySat + payHoliday + mealWD + mealSat + mealH + otBonus;
      const totalDed = labor + personalHealth + dependentHealth + welfare + pension + supPremium + leaveDeduct + bonusDeduct;
      const net = totalBase + totalAdd - totalDed;

      // 7. æ›´æ–° UI
      document.getElementById("resHourly").textContent = hourly.toFixed(2);
      document.getElementById("resWD").textContent = formatCurrency(payWD);
      document.getElementById("resSat").textContent = formatCurrency(paySat);
      document.getElementById("resHoliday").textContent = formatCurrency(payHoliday);
      document.getElementById("resMealWD").textContent = mealWD;
      document.getElementById("resMealSat").textContent = mealSat;
      document.getElementById("resMealHoliday").textContent = mealH;
      document.getElementById("resTotalAdd").textContent = formatCurrency(totalAdd);

      // çé‡‘é¡¯ç¤º
      const bonusRow = document.getElementById("bonusRow");
      if(otBonus > 0) {
        bonusRow.innerHTML = `<div class="payslip-row"><span class="key">åŠ ç­æ™‚æ•¸çé‡‘</span><span class="val text-success">${formatCurrency(otBonus)}</span></div>`;
      } else {
        bonusRow.innerHTML = "";
      }

      document.getElementById("dedLabor").textContent = formatCurrency(labor);
      document.getElementById("dedHealthP").textContent = formatCurrency(personalHealth);
      document.getElementById("dedHealthD").textContent = formatCurrency(dependentHealth);
      document.getElementById("dedWelfare").textContent = formatCurrency(welfare);
      document.getElementById("dedPension").textContent = formatCurrency(pension);
      document.getElementById("dedSup").textContent = formatCurrency(supPremium);
      document.getElementById("dedLeave").textContent = formatCurrency(leaveDeduct);
      
      // å…¨å‹¤çé‡‘æ‰£é™¤é¡¯ç¤º
      const dedBonusRow = document.getElementById("dedBonusRow");
      const dedBonus = document.getElementById("dedBonus");
      if (bonusDeduct > 0) {
        dedBonusRow.style.display = "flex";
        dedBonus.textContent = formatCurrency(bonusDeduct);
      } else {
        dedBonusRow.style.display = "none";
      }
      
      document.getElementById("resTotalDed").textContent = formatCurrency(totalDed);

      document.getElementById("finalNetPay").textContent = "NT$ " + formatCurrency(net);

      // é¡¯ç¤ºçµæœå€
      const resArea = document.getElementById("resultArea");
      resArea.classList.remove("hidden");
      resArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /* === å½ˆçª—é‚è¼¯ === */
    function closePopup() {
      document.getElementById("popupModal").classList.remove("active");
    }

    window.addEventListener('DOMContentLoaded', function() {
      const startDateInput = document.getElementById("startDate");
      const endDateInput = document.getElementById("endDate");
      
      // ä½¿ç”¨è‡ªå‹•è¨ˆç®—çš„çµç®—å€é–“
      document.getElementById("popupText").innerHTML = popupConfig.content.replace(/\n/g, "<br>");
      startDateInput.value = popupConfig.range.start;
      endDateInput.value = popupConfig.range.end;
      
      setTimeout(() => {
        document.getElementById("popupModal").classList.add("active");
      }, 600);
    });

    /* === PWA Service Worker Registration === */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼Œè‡ªå‹•é©æ‡‰éƒ¨ç½²è·¯å¾‘
        const swPath = './service-worker.js';
        
        navigator.serviceWorker.register(swPath, { scope: './' })
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
            
            // æª¢æŸ¥æ›´æ–°
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œè‡ªå‹•æ›´æ–°
                    console.log('New service worker available, updating...');
                    newWorker.postMessage({ action: 'skipWaiting' });
                  }
                });
              }
            });

            // å®šæœŸæª¢æŸ¥æ›´æ–°ï¼ˆæ¯å°æ™‚æª¢æŸ¥ä¸€æ¬¡ï¼‰
            setInterval(() => {
              registration.update();
            }, 60 * 60 * 1000);

            // ç•¶é é¢ç²å¾—ç„¦é»æ™‚æª¢æŸ¥æ›´æ–°
            document.addEventListener('visibilitychange', () => {
              if (!document.hidden) {
                registration.update();
              }
            });
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
            // å¦‚æœè¨»å†Šå¤±æ•—ï¼Œä¸å½±éŸ¿æ‡‰ç”¨æ­£å¸¸ä½¿ç”¨
          });
      });

      // ç›£è½ Service Worker æ›´æ–°
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (!refreshing) {
          refreshing = true;
          window.location.reload();
        }
      });
    }
  </script>
</body>
</html>
